using System;
using System.Collections.Generic;
using System.Data;
using System.Data.Common;
using System.IO;
using System.Linq;
using System.Reflection;
using System.Text;

namespace ${NAMESPACE}
{
	public class ${CLASS_NAME}
	{
		public static async Task<${RETURN_TYPE}> InvokeAsync(DbConnection connection, DbTransaction transaction, ${PARAMETER_TYPE} parameter)
		{
			await using var command = connection.CreateCommand();
            command.Transaction = transaction;
			const string commandLocation = "${COMMAND_LOCATION}";
            using var stream = Assembly.GetExecutingAssembly().GetManifestResourceStream(commandLocation) ?? throw new InvalidOperationException($"SQL resource not found: {commandLocation}");
            using var streamReader = new StreamReader(stream);
            command.CommandText = await streamReader.ReadToEndAsync();
            command.CommandTimeout = 60;

			${PARAMETERS_PLACEHOLDER}

			var results = new List<${RESULT_TYPE}_Raw>();
            await using var reader = await command.ExecuteReaderAsync();

			while (await reader.ReadAsync())
			{
				var resultItem = new ${RESULT_TYPE}_Raw();

				${READER_ITEMS}

				results.Add(resultItem);
			}

			${RETURN_PLACEHOLDER}

            return result;
		}

		${RAW_CLASS}
	}

	${CUSTOM_CLASSES}
}